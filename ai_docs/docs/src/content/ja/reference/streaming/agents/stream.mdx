---
title: "リファレンス: Agent.stream() | Agents | Mastra ドキュメント"
description: "Mastra エージェントの `Agent.stream()` メソッドに関するドキュメント。応答をリアルタイムにストリーミングできます。"
---

# Agent.stream()

`.stream()` メソッドは、エージェントの応答をリアルタイムでストリーミングします。このメソッドは、メッセージと任意のストリーミングオプションを受け取ります。

## 使用例

```typescript copy
await agent.stream("message for agent");
```

## パラメータ

<PropertiesTable
  content={[
    {
      name: "messages",
      type: "string | string[] | CoreMessage[] | AiMessageType[] | UIMessageWithMetadata[]",
      description: "エージェントに送信するメッセージ。単一の文字列、文字列配列、または構造化メッセージオブジェクトを指定できます。",
    },
    {
      name: "options",
      type: "AgentStreamOptions<OUTPUT, EXPERIMENTAL_OUTPUT>",
      isOptional: true,
      description: "ストリーミング処理に関するオプション設定。",
    },
  ]}
/>

### オプションパラメータ

<PropertiesTable
  content={[
  {
    name: "abortSignal",
    type: "AbortSignal",
    isOptional: true,
    description:
      "エージェントの実行を中断できる Signal オブジェクト。シグナルが中断されると、進行中の操作はすべて終了します。",
  },
  {
    name: "context",
    type: "CoreMessage[]",
    isOptional: true,
    description: "エージェントに渡す追加のコンテキストメッセージ。",
  },
  {
    name: "experimental_output",
    type: "Zod schema | JsonSchema7",
    isOptional: true,
    description:
      "テキスト生成やツール呼び出しに加えて、構造化出力の生成を有効にします。モデルは提供されたスキーマに準拠する応答を生成します。",
  },
  {
    name: "instructions",
    type: "string",
    isOptional: true,
    description:
      "この生成に対してエージェントのデフォルトの指示を上書きするカスタム指示。新しいエージェントインスタンスを作成せずに動作を動的に変更するのに有用です。",
  },
  {
    name: "output",
    type: "Zod schema | JsonSchema7",
    isOptional: true,
    description:
      "想定される出力の構造を定義します。JSON Schema オブジェクトまたは Zod スキーマを指定できます。",
  },
  {
    name: "memory",
    type: "object",
    isOptional: true,
    description: "メモリの設定。メモリ管理の推奨方法です。",
    properties: [
      {
        parameters: [{
            name: "thread",
            type: "string | { id: string; metadata?: Record<string, any>, title?: string }",
            isOptional: false,
            description: "会話スレッド。文字列の ID、または `id` と任意の `metadata` を持つオブジェクトとして指定します。",
        }]
      },
      {
        parameters: [{
            name: "resource",
            type: "string",
            isOptional: false,
            description: "スレッドに関連付けられたユーザーまたはリソースの識別子。",
        }]
      },
      {
        parameters: [{
            name: "options",
            type: "MemoryConfig",
            isOptional: true,
            description: "メッセージ履歴やセマンティック・リコールなど、メモリ動作の設定。",
        }]
      }
    ]
  },
  {
    name: "maxSteps",
    type: "number",
    isOptional: true,
    defaultValue: "5",
    description: "許可される実行ステップ数の上限。",
  },
  {
    name: "maxRetries",
    type: "number",
    isOptional: true,
    defaultValue: "2",
    description: "リトライの最大回数。無効にするには 0 を設定します。",
  },
  {
    name: "memoryOptions",
    type: "MemoryConfig",
    isOptional: true,
    description:
      "**非推奨。** 代わりに `memory.options` を使用してください。メモリ管理の設定オプション。",
    properties: [
      {
        parameters: [{
          name: "lastMessages",
          type: "number | false",
          isOptional: true,
          description: "コンテキストに含める直近メッセージ数。false で無効化。",
        }]
      },
      {
        parameters: [{
          name: "semanticRecall",
          type: "boolean | { topK: number; messageRange: number | { before: number; after: number }; scope?: 'thread' | 'resource' }",
          isOptional: true,
          description: "関連する過去メッセージを見つけるためのセマンティック・リコールを有効にします。真偽値または詳細設定を指定できます。",
        }]
      },
      {
        parameters: [{
          name: "workingMemory",
          type: "WorkingMemory",
          isOptional: true,
          description: "ワーキングメモリ機能の設定。",
        }]
      },
      {
        parameters: [{
          name: "threads",
          type: "{ generateTitle?: boolean | { model: DynamicArgument<MastraLanguageModel>; instructions?: DynamicArgument<string> } }",
          isOptional: true,
          description: "スレッド固有の設定。タイトルの自動生成を含みます。",
        }]
      }
    ]
  },
  {
    name: "onFinish",
    type: "StreamTextOnFinishCallback<any> | StreamObjectOnFinishCallback<OUTPUT>",
    isOptional: true,
    description:
      "ストリーミング完了時に呼び出されるコールバック関数。最終結果を受け取ります。",
  },
  {
    name: "onStepFinish",
    type: "StreamTextOnStepFinishCallback<any> | never",
    isOptional: true,
    description:
      "各実行ステップ後に呼び出されるコールバック関数。ステップの詳細を JSON 文字列で受け取ります。構造化出力では利用できません。",
  },
  {
    name: "resourceId",
    type: "string",
    isOptional: true,
    description:
      "**非推奨。** 代わりに `memory.resource` を使用してください。エージェントと対話するユーザーまたはリソースの識別子。threadId が指定されている場合は必須です。",
  },
  {
    name: "telemetry",
    type: "TelemetrySettings",
    isOptional: true,
    description:
      "ストリーミング中のテレメトリ収集の設定。",
    properties: [
      {
        parameters: [{
          name: "isEnabled",
          type: "boolean",
          isOptional: true,
          description: "テレメトリを有効化／無効化します。実験段階ではデフォルトで無効です。",
        }]
      },
      {
        parameters: [{
          name: "recordInputs",
          type: "boolean",
          isOptional: true,
          description: "入力の記録を有効化／無効化します。デフォルトで有効です。機微情報の記録を避けるために無効化することがあります。",
        }]
      },
      {
        parameters: [{
          name: "recordOutputs",
          type: "boolean",
          isOptional: true,
          description: "出力の記録を有効化／無効化します。デフォルトで有効です。機微情報の記録を避けるために無効化することがあります。",
        }]
      },
      {
        parameters: [{
          name: "functionId",
          type: "string",
          isOptional: true,
          description: "この関数の識別子。関数単位でテレメトリデータをグループ化するために使用します。",
        }]
      }
    ]
  },
  {
    name: "temperature",
    type: "number",
    isOptional: true,
    description:
      "モデル出力のランダム性を制御します。値が高い（例: 0.8）ほどランダム性が高く、低い（例: 0.2）ほど焦点が定まり決定的になります。",
  },
  {
    name: "threadId",
    type: "string",
    isOptional: true,
    description:
      "**非推奨。** 代わりに `memory.thread` を使用してください。会話スレッドの識別子。複数のやり取りにわたりコンテキストを維持できます。resourceId が指定されている場合は必須です。",
  },
  {
    name: "toolChoice",
    type: "'auto' | 'none' | 'required' | { type: 'tool'; toolName: string }",
    isOptional: true,
    defaultValue: "'auto'",
    description: "ストリーミング中にエージェントがツールをどう使用するかを制御します。",
    properties: [
      {
        parameters: [{
          name: "'auto'",
          type: "string",
          description: "ツールを使用するかどうかをモデルに任せる（デフォルト）。",
        }]
      },
      {
        parameters: [{
          name: "'none'",
          type: "string",
          description: "いかなるツールも使用しない。",
        }]
      },
      {
        parameters: [{
          name: "'required'",
          type: "string",
          description: "少なくとも 1 つのツールを使用するようモデルに要求する。",
        }]
      },
      {
        parameters: [{
          name: "{ type: 'tool'; toolName: string }",
          type: "object",
          description: "指定した名前の特定のツールを使用するようモデルに要求する。",
        }]
      }
    ]
  },
  {
    name: "toolsets",
    type: "ToolsetsInput",
    isOptional: true,
    description:
      "ストリーミング中にエージェントが利用できる追加のツールセット。",
  },
  {
    name: "clientTools",
    type: "ToolsInput",
    isOptional: true,
    description:
      "リクエストの「クライアント」側で実行されるツール。これらのツールは定義内に execute 関数を持ちません。",
  },
  {
    name: "savePerStep",
    type: "boolean",
    isOptional: true,
    description: "各ストリームステップ完了後にメッセージを逐次保存します（デフォルト: false）。",
  },
  {
    name: "providerOptions",
    type: "Record<string, Record<string, JSONValue>>",
    isOptional: true,
    description: "基盤となる LLM プロバイダーに渡される、プロバイダー固有の追加オプション。構造は `{ providerName: { optionKey: value } }`。例: `{ openai: { reasoningEffort: 'high' }, anthropic: { maxTokens: 1000 } }`。",
    properties: [
      {
        parameters: [{
          name: "openai",
          type: "Record<string, JSONValue>",
          isOptional: true,
          description: "OpenAI 固有のオプション。例: `{ reasoningEffort: 'high' }`",
        }]
      },
      {
        parameters: [{
          name: "anthropic",
          type: "Record<string, JSONValue>",
          isOptional: true,
          description: "Anthropic 固有のオプション。例: `{ maxTokens: 1000 }`",
        }]
      },
      {
        parameters: [{
          name: "google",
          type: "Record<string, JSONValue>",
          isOptional: true,
          description: "Google 固有のオプション。例: `{ safetySettings: [...] }`",
        }]
      },
      {
        parameters: [{
          name: "[providerName]",
          type: "Record<string, JSONValue>",
          isOptional: true,
          description: "その他のプロバイダー固有のオプション。キーはプロバイダー名、値はプロバイダー固有オプションのレコードです。",
        }]
      }
    ]
  },
  {
    name: "runId",
    type: "string",
    isOptional: true,
    description: "この生成実行の一意の ID。追跡やデバッグに有用です。",
  },
  {
    name: "runtimeContext",
    type: "RuntimeContext",
    isOptional: true,
    description: "依存性注入やコンテキスト情報のためのランタイムコンテキスト。",
  },
  {
    name: "maxTokens",
    type: "number",
    isOptional: true,
    description: "生成するトークン数の上限。",
  },
  {
    name: "topP",
    type: "number",
    isOptional: true,
    description: "Nucleus サンプリング。0〜1 の数値。`temperature` か `topP` のどちらか一方のみの設定を推奨します。",
  },
  {
    name: "topK",
    type: "number",
    isOptional: true,
    description: "各次トークンで上位 K 個の選択肢からのみサンプリングします。低確率の“ロングテール”応答を除外するために使用します。",
  },
  {
    name: "presencePenalty",
    type: "number",
    isOptional: true,
    description: "Presence penalty の設定。プロンプト内の既存情報をモデルが繰り返す可能性に影響します。-1（繰り返しを増やす）から 1（最大のペナルティで繰り返しを抑制）までの数値。",
  },
  {
    name: "frequencyPenalty",
    type: "number",
    isOptional: true,
    description: "Frequency penalty の設定。同じ語や句を繰り返し使用する可能性に影響します。-1（繰り返しを増やす）から 1（最大のペナルティで繰り返しを抑制）までの数値。",
  },
  {
    name: "stopSequences",
    type: "string[]",
    isOptional: true,
    description: "ストップシーケンス。設定すると、いずれかのストップシーケンスが生成された時点でモデルはテキスト生成を停止します。",
  },
  {
    name: "seed",
    type: "number",
    isOptional: true,
    description: "ランダムサンプリングに使用するシード（整数）。設定され、モデルが対応している場合は決定的な結果を生成します。",
  },
  {
    name: "headers",
    type: "Record<string, string | undefined>",
    isOptional: true,
    description: "リクエストに同送する追加の HTTP ヘッダー。HTTP ベースのプロバイダーにのみ適用されます。",
  }
]}
/>

## 戻り値

<PropertiesTable
  content={[
    {
      name: "textStream",
      type: "AsyncGenerator<string>",
      isOptional: true,
      description:
        "利用可能になり次第、テキストのチャンクを順次返す非同期ジェネレーター。",
    },
    {
      name: "fullStream",
      type: "Promise<ReadableStream>",
      isOptional: true,
      description:
        "完全なレスポンスを表す ReadableStream へ解決される Promise。",
    },
    {
      name: "text",
      type: "Promise<string>",
      isOptional: true,
      description:
        "完全なテキストレスポンスへ解決される Promise。",
    },
    {
      name: "usage",
      type: "Promise<{ totalTokens: number; promptTokens: number; completionTokens: number }>",
      isOptional: true,
      description:
        "トークン使用量の情報へ解決される Promise。",
    },
    {
      name: "finishReason",
      type: "Promise<string>",
      isOptional: true,
      description:
        "ストリームが終了した理由へ解決される Promise。",
    },
    {
      name: "toolCalls",
      type: "Promise<Array<ToolCall>>",
      isOptional: true,
      description:
        "ストリーミング処理中に行われたツール呼び出しへ解決される Promise。",
      properties: [
        {
          parameters: [{
            name: "toolName",
            type: "string",
            required: true,
            description: "呼び出されたツール名。"
          }]
        },
        {
          parameters: [{
            name: "args",
            type: "any",
            required: true,
            description: "ツールに渡された引数。"
          }]
        }
      ]
    },
  ]}
/>

## 発展的な使用例

```typescript showLineNumbers copy
await agent.stream("message for agent", {
  temperature: 0.7,
  maxSteps: 3,
  memory: {
    thread: "user-123",
    resource: "test-app"
  },
  toolChoice: "auto"
});
```

## 関連

- [応答の生成](../../docs/agents/overview.mdx#generating-responses)
- [応答のストリーミング](../../docs/agents/overview.mdx#streaming-responses)