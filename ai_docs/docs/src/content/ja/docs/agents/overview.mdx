---
title: "ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¦‚è¦ | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | Mastra"
description: Mastra ã«ãŠã‘ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¦‚è¦ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ©Ÿèƒ½ã‚„ã€ãƒ„ãƒ¼ãƒ«ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã€å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºæ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
---

import { Steps } from "nextra/components";


# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½¿ç”¨

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€è¨€èªãƒ¢ãƒ‡ãƒ«ã‚’æ´»ç”¨ã—ã¦æ„æ€æ±ºå®šã‚„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡ŒãŒã§ãã‚‹ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãªã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®ä»•çµ„ã¿ã§ã™ã€‚å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¯å¿…é ˆã®æŒ‡ç¤ºã¨ LLM ãŒã‚ã‚Šã€å¿…è¦ã«å¿œã˜ã¦ãƒ„ãƒ¼ãƒ«ã‚„ãƒ¡ãƒ¢ãƒªã‚’è¿½åŠ ã§ãã¾ã™ã€‚

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ä¼šè©±ã‚’ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã€å¿…è¦ã«å¿œã˜ã¦ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—ã€ãƒ¡ãƒ¢ãƒªã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¶­æŒã—ã€ã‚„ã‚Šå–ã‚Šã«åˆã‚ã›ãŸå¿œç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯å˜ä½“ã§å‹•ä½œã•ã›ã‚‹ã“ã¨ã‚‚ã€ã‚ˆã‚Šå¤§ããªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¸€éƒ¨ã¨ã—ã¦é€£æºã•ã›ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

![Agents overview](/image/agents/agents-overview.jpg)

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã«ã¯:

- `Agent` ã‚¯ãƒ©ã‚¹ã§ **instructions** ã‚’å®šç¾©ã—ã€ä½¿ç”¨ã™ã‚‹ **LLM** ã‚’è¨­å®šã—ã¾ã™ã€‚
- æ©Ÿèƒ½æ‹¡å¼µã®ãŸã‚ã«ã€å¿…è¦ã«å¿œã˜ã¦ **tools** ã¨ **memory** ã‚’æ§‹æˆã—ã¾ã™ã€‚
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¦å¿œç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã€æ§‹é€ åŒ–å‡ºåŠ›ã€å‹•çš„ãªè¨­å®šã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯å‹å®‰å…¨æ€§ã¨å®Ÿè¡Œæ™‚ã®æ¤œè¨¼ã‚’æä¾›ã—ã€ã™ã¹ã¦ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã§ä¸€è²«ã—ã¦ä¿¡é ¼ã§ãã‚‹å‹•ä½œã‚’ä¿è¨¼ã—ã¾ã™ã€‚

> **ğŸ“¹ è¦–è´**:  â†’ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®æ¦‚è¦ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã®æ¯”è¼ƒ [YouTube (7 minutes)](https://youtu.be/0jg2g3sNvgw)

## ã¯ã˜ã‚ã«

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ã†ã«ã¯ã€å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™:

```bash
npm install @mastra/core @ai-sdk/openai
```

> Mastra ã¯ã™ã¹ã¦ã® AI SDK ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚è©³ã—ãã¯ [Model Providers](../getting-started/model-providers.mdx) ã‚’ã”è¦§ãã ã•ã„ã€‚

agents ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰å¿…è¦ãªã‚¯ãƒ©ã‚¹ã¨ã€LLM ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™:

```typescript filename="src/mastra/agents/test-agent.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";
```

### LLM ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼

å„ LLM ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã«ã¯ã€ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è­˜åˆ¥å­ã‚’ä½¿ã£ã¦å‘½åã•ã‚ŒãŸç‹¬è‡ªã® API ã‚­ãƒ¼ãŒå¿…è¦ã§ã™ã€‚

```bash filename=".env" copy
OPENAI_API_KEY=<your-api-key>
```

> è©³ç´°ã¯ Vercel AI SDK ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã® [AI SDK Providers](https://ai-sdk.dev/providers/ai-sdk-providers) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæˆ

Mastraã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã«ã¯ã€`Agent` ã‚¯ãƒ©ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã™ã¹ã¦ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã¯ã€ãã®å‹•ä½œã‚’å®šç¾©ã™ã‚‹ãŸã‚ã® `instructions` ã¨ã€LLM ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®šã™ã‚‹ãŸã‚ã® `model` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¿…è¦ã§ã™ã€‚

```typescript filename="src/mastra/agents/test-agent.ts" showLineNumbers copy
import { openai } from "@ai-sdk/openai";
import { Agent } from "@mastra/core/agent";

export const testAgent = new Agent({
  name: "test-agent",
  instructions: "You are a helpful assistant.",
  model: openai("gpt-4o-mini")
});
```

> è©³ç´°ã¯ [Agent](../../reference/agents/agent.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ç™»éŒ²

Mastra ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç™»éŒ²ã—ã¾ã™:

```typescript showLineNumbers filename="src/mastra/index.ts" copy
import { Mastra } from "@mastra/core/mastra";
import { testAgent } from './agents/test-agent';

export const mastra = new Mastra({
  // ...
  agents: { testAgent },
});
```

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‚ç…§

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¹ãƒ†ãƒƒãƒ—ã€ãƒ„ãƒ¼ãƒ«ã€Mastra Clientã€ã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã›ã¾ã™ã€‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«å¿œã˜ã¦ã€`mastra` ã¾ãŸã¯ `mastraClient` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ `.getAgent()` ã‚’å‘¼ã³å‡ºã—ã¦å‚ç…§ã‚’å–å¾—ã—ã¾ã™ã€‚

```typescript showLineNumbers copy
const testAgent = mastra.getAgent("testAgent");
```

> è©³ç´°ã¯ [Calling agents](../../examples/agents/calling-agents.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ç”Ÿæˆ

`.generate()` ã‚’ä½¿ç”¨ã—ã¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ã—ã¾ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã¯å˜ä¸€ã®æ–‡å­—åˆ—ã‚’æ¸¡ã—ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æä¾›ã™ã‚‹å ´åˆã¯æ–‡å­—åˆ—ã®é…åˆ—ã‚’ã€å½¹å‰²ã‚„ä¼šè©±ã®æµã‚Œã‚’å³å¯†ã«åˆ¶å¾¡ã™ã‚‹å ´åˆã¯ `role` ã¨ `content` ã‚’æŒã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚

> è©³ç´°ã¯ [.generate()](../../reference/agents/generate.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ†ã‚­ã‚¹ãƒˆã®ç”Ÿæˆ

`role` ã¨ `content` ã‚’å«ã‚€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ¸¡ã—ã¦ `.generate()` ã‚’å‘¼ã³å‡ºã—ã¾ã™:

```typescript showLineNumbers copy
const response = await testAgent.generate([
  { role: "user", content: "1æ—¥ã®äºˆå®šã‚’ç«‹ã¦ã‚‹ã®ã‚’æ‰‹ä¼ã£ã¦ãã ã•ã„" },
  { role: "user", content: "ç§ã®1æ—¥ã¯åˆå‰9æ™‚ã«å§‹ã¾ã‚Šã€åˆå¾Œ5æ™‚30åˆ†ã«çµ‚ã‚ã‚Šã¾ã™" },
  { role: "user", content: "æ˜¼é£Ÿã¯12:30ã‹ã‚‰13:30ã®é–“ã«å–ã‚Šã¾ã™" },
  { role: "user", content: "æœˆæ›œã‹ã‚‰é‡‘æ›œã®10:30ã‹ã‚‰11:30ã¾ã§ä¼šè­°ãŒã‚ã‚Šã¾ã™" }
]);

console.log(response.text);
```

## ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”

ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®å¿œç­”ã«ã¯ `.stream()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚å˜ç´”ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ã¯å˜ä¸€ã®æ–‡å­—åˆ—ã‚’ã€è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æä¾›ã™ã‚‹å ´åˆã¯æ–‡å­—åˆ—ã®é…åˆ—ã‚’ã€å½¹å‰²ã‚„ä¼šè©±ã®æµã‚Œã‚’å³å¯†ã«åˆ¶å¾¡ã™ã‚‹å ´åˆã¯ `role` ã¨ `content` ã‚’æŒã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚

> è©³ç´°ã¯ [.stream()](../../reference/agents/stream.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°

`role` ã¨ `content` ã‚’å«ã‚€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—ã‚’æ¸¡ã—ã¦ `.stream()` ã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

```typescript showLineNumbers copy
const stream = await testAgent.stream([
  { role: "user", content: "Help me organize my day" },
  { role: "user", content: "My day starts at 9am and finishes at 5.30pm" },
  { role: "user", content: "I take lunch between 12:30 and 13:30" },
  { role: "user", content: "I have meetings Monday to Friday between 10:30 and 11:30" }
]);

for await (const chunk of stream.textStream) {
  process.stdout.write(chunk);
}
```

### `onFinish()` ã‚’ä½¿ã£ãŸå®Œäº†å‡¦ç†

ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”ã§ã¯ã€`onFinish()` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ã€LLM ãŒå¿œç­”ã®ç”Ÿæˆã‚’å®Œäº†ã—ã€ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å®Ÿè¡ŒãŒçµ‚äº†ã—ãŸå¾Œã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€æœ€çµ‚çš„ãª `text`ã€å®Ÿè¡Œã® `steps`ã€`finishReason`ã€ãƒˆãƒ¼ã‚¯ãƒ³ã® `usage` çµ±è¨ˆã€ãã—ã¦ç›£è¦–ã‚„ãƒ­ã‚°ã«å½¹ç«‹ã¤ãã®ä»–ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒæä¾›ã•ã‚Œã¾ã™ã€‚

```typescript showLineNumbers copy
const stream = await testAgent.stream("Help me organize my day", {
  onFinish: ({ steps, text, finishReason, usage }) => {
    console.log({ steps, text, finishReason, usage });
  }
});

for await (const chunk of stream.textStream) {
  process.stdout.write(chunk);
}
```

## æ§‹é€ åŒ–ã•ã‚ŒãŸå‡ºåŠ›

Agents ã¯ã€[Zod](https://zod.dev/) ã¾ãŸã¯ [JSON Schema](https://json-schema.org/) ã‚’ä½¿ç”¨ã—ã¦æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€æ§‹é€ åŒ–ã•ã‚ŒãŸå‹å®‰å…¨ãªãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã›ã¾ã™ã€‚ã„ãšã‚Œã®å ´åˆã‚‚ã€è§£æçµæœã¯ `response.object` ã§åˆ©ç”¨ã§ãã€æ¤œè¨¼æ¸ˆã¿ã‹ã¤å‹ä»˜ã‘ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥æ‰±ãˆã¾ã™ã€‚

### Zod ã‚’ä½¿ç”¨ã™ã‚‹

[Zod](https://zod.dev/) ã‚’ä½¿ã£ã¦ `output` ã®ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã¾ã™:

```typescript showLineNumbers copy
import { z } from "zod";

const response = await testAgent.generate(
  [
    {
      role: "system",
      content: "ä»¥ä¸‹ã®ãƒ†ã‚­ã‚¹ãƒˆã®è¦ç´„ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚"
    },
    {
      role: "user",
      content: "Monkey, Ice Cream, Boat"
    }
  ],
  {
    output: z.object({
      summary: z.string(),
      keywords: z.array(z.string())
    })
  }
);

console.log(response.object);
```

#### ãƒ„ãƒ¼ãƒ«å¯¾å¿œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§æ§‹é€ åŒ–å‡ºåŠ›ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€`experimental_output` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½¿ç”¨ã—ã¾ã™:

```typescript {6} showLineNumbers copy
import { z } from "zod";

const response = await testAgent.generate(
  // ...
  {
    experimental_output: z.object({
      summary: z.string(),
      keywords: z.array(z.string())
    })
  }
);

console.log(response.object);
```

## ç”»åƒã®è¨˜è¿°

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€ç”»åƒå†…ã®è¦–è¦šæƒ…å ±ã¨ãƒ†ã‚­ã‚¹ãƒˆã®ä¸¡æ–¹ã‚’å‡¦ç†ã—ã¦ã€ç”»åƒã‚’åˆ†æãƒ»è¨˜è¿°ã§ãã¾ã™ã€‚ç”»åƒåˆ†æã‚’æœ‰åŠ¹ã«ã™ã‚‹ã«ã¯ã€`content` é…åˆ—ã« `type: 'image'` ã¨ç”»åƒã®URLã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¸¡ã—ã¾ã™ã€‚ç”»åƒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ãƒ†ã‚­ã‚¹ãƒˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’çµ„ã¿åˆã‚ã›ã¦ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®åˆ†æã‚’èª˜å°ã§ãã¾ã™ã€‚

```typescript showLineNumbers copy
const response = await testAgent.generate([
  {
    role: "user",
    content: [
      {
        type: "image",
        image: "https://placebear.com/cache/395-205.jpg",
        mimeType: "image/jpeg"
      },
      {
        type: "text",
        text: "Describe the image in detail, and extract all the text in the image."
      }
    ]
  }
]);

console.log(response.text);
```

## ãƒãƒ«ãƒã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ„ãƒ¼ãƒ«æ´»ç”¨

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ã€ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆã®æ ã‚’è¶…ãˆã¦èƒ½åŠ›ã‚’æ‹¡å¼µã™ã‚‹ã€Œãƒ„ãƒ¼ãƒ«ã€ï¼ˆé–¢æ•°ï¼‰ã«ã‚ˆã£ã¦å¼·åŒ–ã§ãã¾ã™ã€‚ãƒ„ãƒ¼ãƒ«ã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯è¨ˆç®—ã‚’è¡Œã„ã€å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã§ãã¾ã™ã€‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ä¸ãˆã‚‰ã‚ŒãŸãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã™ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã™ã‚‹ã ã‘ã§ãªãã€ãã®ãƒ„ãƒ¼ãƒ«ã«æ¸¡ã™ã¹ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚‚è‡ªã‚‰æ±ºå®šã—ã¾ã™ã€‚

ãƒ„ãƒ¼ãƒ«ã®ä½œæˆã¨è¨­å®šã«é–¢ã™ã‚‹è©³ã—ã„ã‚¬ã‚¤ãƒ‰ã¯ã€[Tools Overview](../tools-mcp/overview.mdx) ãƒšãƒ¼ã‚¸ã‚’ã”è¦§ãã ã•ã„ã€‚

### `maxSteps` ã®ä½¿ç”¨

`maxSteps` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ã€ç‰¹ã«ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’è¡Œã†å ´åˆã«ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå®Ÿè¡Œã§ãã‚‹é€£ç¶šã—ãŸ LLM å‘¼ã³å‡ºã—ã®æœ€å¤§å›æ•°ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ 1 ã«è¨­å®šã•ã‚Œã¦ãŠã‚Šã€ãƒ„ãƒ¼ãƒ«ã®èª¤è¨­å®šã«ã‚ˆã‚‹ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’é˜²ããŸã‚ã®ã‚‚ã®ã§ã™ã€‚

```typescript showLineNumbers copy
const response = await testAgent.generate("Help me organize my day", {
  maxSteps: 5
});

console.log(response.text);
```

### `onStepFinish` ã®ä½¿ç”¨

`onStepFinish` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ã†ã¨ã€è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã«ã‚ãŸã‚‹å‡¦ç†ã®é€²æ—ã‚’ç›£è¦–ã§ãã¾ã™ã€‚ãƒ‡ãƒãƒƒã‚°ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€²æ—é€šçŸ¥ã«ä¾¿åˆ©ã§ã™ã€‚

`onStepFinish` ã¯ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°æ™‚ã€ã¾ãŸã¯æ§‹é€ åŒ–ã•ã‚Œã¦ã„ãªã„å‡ºåŠ›ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆã™ã‚‹å ´åˆã«ã®ã¿åˆ©ç”¨ã§ãã¾ã™ã€‚

```typescript showLineNumbers copy
const response = await testAgent.generate("Help me organize my day", {
  onStepFinish: ({ text, toolCalls, toolResults, finishReason, usage }) => {
    console.log({ text, toolCalls, toolResults, finishReason, usage });
  }
});
```

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã™ã‚‹

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œã—ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•ã¯2ã¤ã‚ã‚Šã¾ã™ã€‚

<Steps>

### Mastra Playground

Mastra Dev Server ã‚’èµ·å‹•ã—ãŸçŠ¶æ…‹ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:4111/agents](http://localhost:4111/agents) ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Mastra Playground ã‹ã‚‰ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚

> ãã‚ã—ãã¯ã€[Local Dev Playground](/docs/server-db/local-dev-playground) ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”è¦§ãã ã•ã„ã€‚

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³

`.generate()` ã¾ãŸã¯ `.stream()` ã‚’ä½¿ã£ã¦ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

```typescript {7} filename="src/test-agent.ts" showLineNumbers copy
import "dotenv/config";

import { mastra } from "./mastra";

const agent = mastra.getAgent("testAgent");

const response = await agent.generate("Help me organize my day");

console.log(response.text);
```

> ãã‚ã—ãã¯ [.generate()](../../reference/agents/generate.mdx) ã¾ãŸã¯ [.stream()](../../reference/agents/stream.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã«ã¯ã€æ¬¡ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash copy
npx tsx src/test-agent.ts
```

</Steps>

## é–¢é€£é …ç›®

- [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ¡ãƒ¢ãƒª](./agent-memory.mdx)
- [ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ](./dynamic-agents.mdx)
- [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ãƒ„ãƒ¼ãƒ«ã¨MCP](./using-tools-and-mcp.mdx)
- [ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å‘¼ã³å‡ºã—](../../examples/agents/calling-agents.mdx)