---
title: "è¤‡é›‘ãª LLM ã®æ“ä½œã‚’æ‰±ã† | Workflows | Mastra"
description: "Mastra ã® Workflows ã¯ã€åˆ†å²ã‚„ä¸¦åˆ—å®Ÿè¡Œã€ä¸€æ™‚åœæ­¢ãªã©ã®æ©Ÿèƒ½ã‚’å‚™ãˆã€è¤‡é›‘ãªä¸€é€£ã®å‡¦ç†ã‚’æŸ”è»Ÿã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã¾ã™ã€‚"
---

import { Steps } from "nextra/components";


# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¦‚è¦

Workflows ã¯ã€ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã§ã¤ãªãŒã‚‹**å‹ä»˜ãã‚¹ãƒ†ãƒƒãƒ—**ã¨ã—ã¦ã€è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã®ä¸€é€£å‡¦ç†ã‚’å®šç¾©ãƒ»ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ãã¾ã™ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã«ã¯ã€Zod ã‚¹ã‚­ãƒ¼ãƒã§æ¤œè¨¼ã•ã‚Œã‚‹æ˜ç¢ºã«å®šç¾©ã•ã‚ŒãŸå…¥åŠ›ã¨å‡ºåŠ›ãŒã‚ã‚Šã¾ã™ã€‚

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€å®Ÿè¡Œé †åºã€ä¾å­˜é–¢ä¿‚ã€åˆ†å²ã€ä¸¦åˆ—å®Ÿè¡Œã€ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ç®¡ç†ã—ã€å …ç‰¢ã§å†åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ã‚»ã‚¹ã®æ§‹ç¯‰ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚ã‚¹ãƒ†ãƒƒãƒ—ã¯ãƒã‚¹ãƒˆã‚„ã‚¯ãƒ­ãƒ¼ãƒ³ã«ã‚ˆã‚Šã€ã‚ˆã‚Šå¤§è¦æ¨¡ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œã¾ã™ã€‚

![Workflows overview](/image/workflows/workflows-overview.jpg)

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯æ¬¡ã®æ‰‹é †ã§ä½œæˆã—ã¾ã™:

- `createStep` ã§**ã‚¹ãƒ†ãƒƒãƒ—**ã‚’å®šç¾©ã—ã€å…¥å‡ºåŠ›ã‚¹ã‚­ãƒ¼ãƒã¨ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒ‡å®šã—ã¾ã™ã€‚
- `createWorkflow` ã§**ã‚¹ãƒ†ãƒƒãƒ—**ã‚’çµ„ã¿åˆã‚ã›ã¦ã€å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã‚’å®šç¾©ã—ã¾ã™ã€‚
- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**ã‚’å®Ÿè¡Œã—ã¦å…¨ä½“ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å‹•ã‹ã—ã¾ã™ã€‚ã‚µã‚¹ãƒšãƒ³ãƒ‰ã€ãƒ¬ã‚¸ãƒ¥ãƒ¼ãƒ ã€çµæœã®ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’æ¨™æº–ã§ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

ã“ã®æ§‹æˆã«ã‚ˆã‚Šã€å®Œå…¨ãªå‹å®‰å…¨æ€§ã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æ¤œè¨¼ãŒæ‹…ä¿ã•ã‚Œã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã§ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ãŒä¿è¨¼ã•ã‚Œã¾ã™ã€‚

> **ğŸ“¹ è¦–è´**:  â†’ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç´¹ä»‹ã¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®æ¯”è¼ƒ [YouTubeï¼ˆ7 åˆ†ï¼‰](https://youtu.be/0jg2g3sNvgw)

## ã¯ã˜ã‚ã«

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

```bash
npm install @mastra/core
```

`workflows` ã‚µãƒ–ãƒ‘ã‚¹ã‹ã‚‰å¿…è¦ãªé–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ï¼š

```typescript filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";
```

### ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½œæˆã™ã‚‹

ã‚¹ãƒ†ãƒƒãƒ—ã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åŸºæœ¬è¦ç´ ã§ã™ã€‚`createStep` ã‚’ä½¿ã£ã¦ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½œæˆã—ã¾ã™:

```typescript filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
const step1 = createStep({...});
```

> è©³ç´°ã¯ [createStep](../../reference/workflows/step.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä½œæˆ

`createWorkflow` ã‚’ä½¿ã£ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã€`.commit()` ã§ç¢ºå®šã—ã¾ã™ã€‚

```typescript {6,17} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const step1 = createStep({...});

export const testWorkflow = createWorkflow({
  id: "test-workflow",
  description: 'Test workflow',
  inputSchema: z.object({
    input: z.string()
  }),
  outputSchema: z.object({
    output: z.string()
  })
})
  .then(step1)
  .commit();
```

> è©³ç´°ã¯ [workflow](../../reference/workflows/workflow.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—ã®æ§‹æˆ

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€`.then()` ã‚’ä½¿ã£ã¦æ§‹æˆã—ã€é †æ¬¡å®Ÿè¡Œã§ãã¾ã™ã€‚

```typescript {17,18} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep } from "@mastra/core/workflows";
import { z } from "zod";

const step1 = createStep({...});
const step2 = createStep({...});

export const testWorkflow = createWorkflow({
  id: "test-workflow",
  description: 'Test workflow',
  inputSchema: z.object({
    input: z.string()
  }),
  outputSchema: z.object({
    output: z.string()
  })
})
  .then(step1)
  .then(step2)
  .commit();
```

> ã‚¹ãƒ†ãƒƒãƒ—ã¯è¤‡æ•°ã®æ–¹æ³•ã§æ§‹æˆã§ãã¾ã™ã€‚è©³ã—ãã¯ [Control Flow](./control-flow.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

#### ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¯ãƒ­ãƒ¼ãƒ³

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ†ãƒƒãƒ—ã¯ `cloneStep()` ã‚’ä½¿ã£ã¦ã‚¯ãƒ­ãƒ¼ãƒ³ã§ãã€ä»»æ„ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ä½¿ç”¨ã§ãã¾ã™ã€‚

```typescript {5,19} filename="src/mastra/workflows/test-workflow.ts" showLineNumbers copy
import { createWorkflow, createStep, cloneStep } from "@mastra/core/workflows";
import { z } from "zod";

const step1 = createStep({...});
const clonedStep = cloneStep(step1, { id: "cloned-step" });
const step2 = createStep({...});

export const testWorkflow = createWorkflow({
  id: "test-workflow",
  description: 'Test workflow',
  inputSchema: z.object({
    input: z.string()
  }),
  outputSchema: z.object({
    output: z.string()
  })
})
  .then(step1)
  .then(clonedStep)
  .then(step2)
  .commit();
```

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç™»éŒ²

ãƒ¡ã‚¤ãƒ³ã® Mastra ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã§ `workflows` ã‚’ä½¿ã£ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç™»éŒ²ã—ã¾ã™:

```typescript {8} filename="src/mastra/index.ts" showLineNumbers copy
import { Mastra } from "@mastra/core/mastra";
import { PinoLogger } from "@mastra/loggers";
import { LibSQLStore } from "@mastra/libsql";

import { testWorkflow } from "./workflows/test-workflow";

export const mastra = new Mastra({
  workflows: { testWorkflow },
  storage: new LibSQLStore({
    // ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªã‚„è©•ä¾¡ãªã©ã‚’ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ã—ã¾ã™ã€‚æ°¸ç¶šåŒ–ãŒå¿…è¦ãªå ´åˆã¯ file:../mastra.db ã«å¤‰æ›´ã—ã¦ãã ã•ã„
    url: ":memory:"
  }),
  logger: new PinoLogger({
    name: "Mastra",
    level: "info"
  })
});
```

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ãƒ†ã‚¹ãƒˆã™ã‚‹æ–¹æ³•ã¯2ã¤ã‚ã‚Šã¾ã™ã€‚

<Steps>

### Mastra Playground

Mastra Dev Server ã‚’èµ·å‹•ã—ãŸçŠ¶æ…‹ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ [http://localhost:4111/workflows](http://localhost:4111/workflows) ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Mastra Playground ã‹ã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

> è©³ç´°ã¯ [Local Dev Playground](../server-db/local-dev-playground.mdx) ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³

`createRunAsync` ã¨ `start` ã‚’ä½¿ç”¨ã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¾ã™:

```typescript {3,5} filename="src/test-workflow.ts" showLineNumbers copy
import "dotenv/config";

import { mastra } from "./mastra";

const run = await mastra.getWorkflow("testWorkflow").createRunAsync();

const result = await run.start({
  inputData: {
    city: "London"
  }
});

console.log(result);

if (result.status === 'success') {
  console.log(result.result.output);
}
```
> è©³ç´°ã¯ [createRunAsync](../../reference/workflows/run.mdx) ãŠã‚ˆã³ [start](../../reference/workflows/run-methods/start.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹ã«ã¯ã€æ¬¡ã‚’å®Ÿè¡Œã—ã¾ã™:

```bash copy
npx tsx src/test-workflow.ts
```

</Steps>

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œçµæœ

`start()` ã¾ãŸã¯ `resume()` ã‚’ä½¿ã£ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ãŸå ´åˆã®çµæœã¯ã€çŠ¶æ³ã«å¿œã˜ã¦æ¬¡ã®ã„ãšã‚Œã‹ã«ãªã‚Šã¾ã™ã€‚

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: success

```json
{
  "status": "success",
  "steps": {
    // ...
    "step-1": {
      // ...
      "status": "success",
    }
  },
  "result": {
    "output": "London + step-1"
  }
}
```

- **status**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã®æœ€çµ‚çŠ¶æ…‹ã‚’ç¤ºã—ã¾ã™ã€‚`success`ã€`suspended`ã€`error` ã®ã„ãšã‚Œã‹
- **steps**: å…¥åŠ›ã¨å‡ºåŠ›ã‚’å«ã‚ã¦ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä¸€è¦§ã—ã¾ã™
- **status**: å„ã‚¹ãƒ†ãƒƒãƒ—ã®çµæœã‚’ç¤ºã—ã¾ã™
- **result**: `outputSchema` ã«å¾“ã£ã¦å‹ä»˜ã‘ã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æœ€çµ‚å‡ºåŠ›ã‚’å«ã¿ã¾ã™

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: suspended

```json
{
  "status": "suspended",
  "steps": {
    // ...
    "step-1": {
      // ...
      "status": "suspended",
    }
  },
  "suspended": [
    [
      "step-1"
    ]
  ]
}
```

- **suspended**: ç¶šè¡Œã™ã‚‹å‰ã«å…¥åŠ›å¾…ã¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’åˆ—æŒ™ã™ã‚‹ä»»æ„ã®é…åˆ—

#### ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ failed

```json
{
  "status": "failed",
  "steps": {
    // ...
    "step-1": {
      // ...
      "status": "failed",
      "error": "Test error",
    }
  },
  "error": "Test error"
}
```

- **error**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå¤±æ•—ã—ãŸå ´åˆã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å«ã‚€çœç•¥å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

## ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ä¸Šã§ç¤ºã—ãŸ run ãƒ¡ã‚½ãƒƒãƒ‰ã¨åŒæ§˜ã«ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚‚ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§ãã¾ã™ï¼š

```typescript {5} filename="src/test-workflow.ts" showLineNumbers copy
import { mastra } from "./mastra";

const run = await mastra.getWorkflow("testWorkflow").createRunAsync();

const result = await run.stream({
  inputData: {
    city: "London"
  }
});

for await (const chunk of result.stream) {
  console.log(chunk);
}
```

> è©³ç´°ã¯ [stream](../../reference/workflows/run-methods/stream.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç›£è¦–

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ç›£è¦–ã§ãã€ç™ºè¡Œã•ã‚Œã‚‹å„ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç¢ºèªã§ãã¾ã™ã€‚

```typescript {5} filename="src/test-workflow.ts" showLineNumbers copy
import { mastra } from "./mastra";

const run = await mastra.getWorkflow("testWorkflow").createRunAsync();

run.watch((event) => {
  console.log(event);
});

const result = await run.start({
  inputData: {
    city: "London"
  }
});
```

> è©³ç´°ã¯ [watch](../../reference/workflows/run-methods/watch.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## é–¢é€£

- ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã® [Workflow Guide](../../guides/guide/ai-recruiter.mdx) ã¯ã€ä¸»è¦ãªæ¦‚å¿µã‚’æ‰±ã†ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã™ã€‚
- [Parallel Steps ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¾‹](../../examples/workflows/parallel-steps.mdx)
- [Conditional Branching ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¾‹](../../examples/workflows/conditional-branching.mdx)
- [Inngest ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¾‹](../../examples/workflows/inngest-workflow.mdx)
- [Suspend and Resume ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ä¾‹](../../examples/workflows/human-in-the-loop.mdx)

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ï¼‰

ãƒ¬ã‚¬ã‚·ãƒ¼ç‰ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¤ã„ã¦ã¯ã€[Workflows (Legacy)](../workflows-legacy/overview.mdx) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚