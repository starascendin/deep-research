---
title: "Dynamic Agents"
description: 実行時コンテキストを用いて、エージェントの指示、モデル、ツール、メモリを動的に設定します。
---

# ダイナミックエージェント

ダイナミックエージェントは、ユーザーIDやその他の重要なパラメータなどの[ランタイムコンテキスト](./runtime-context)を用いて、設定をリアルタイムに調整します。

つまり、使用するモデルを切り替えたり、インストラクションを更新したり、別のツールを選択したり、必要に応じてメモリを設定したりできます。

このコンテキストを活用することで、エージェントは各ユーザーのニーズにより適切に対応できます。また、追加情報を取得するために任意のAPIを呼び出すこともでき、それによってエージェントの能力を高められます。

### 設定例

以下は、ユーザーのサブスクリプションプランと言語設定に応じて動作を調整する動的サポートエージェントの例です：

```typescript
const supportAgent = new Agent({
  name: "Dynamic Support Agent",

  instructions: async ({ runtimeContext }) => {
    const userTier = runtimeContext.get("user-tier");
    const language = runtimeContext.get("language");

    return `You are a customer support agent for our SaaS platform.
    The current user is on the ${userTier} tier and prefers ${language} language.

    For ${userTier} tier users:
    ${userTier === "free" ? "- Provide basic support and documentation links" : ""}
    ${userTier === "pro" ? "- Offer detailed technical support and best practices" : ""}
    ${userTier === "enterprise" ? "- Provide priority support with custom solutions" : ""}

    Always respond in ${language} language.`;
  },

  model: ({ runtimeContext }) => {
    const userTier = runtimeContext.get("user-tier");
    return userTier === "enterprise"
      ? openai("gpt-4")
      : openai("gpt-3.5-turbo");
  },

  tools: ({ runtimeContext }) => {
    const userTier = runtimeContext.get("user-tier");
    const baseTools = [knowledgeBase, ticketSystem];

    if (userTier === "pro" || userTier === "enterprise") {
      baseTools.push(advancedAnalytics);
    }

    if (userTier === "enterprise") {
      baseTools.push(customIntegration);
    }

    return baseTools;
  },

  memory: ({ runtimeContext }) => {
    const userTier = runtimeContext.get("user-tier");

    if (userTier === "enterprise") {
      return new Memory({
        storage: new LibSQLStore({ url: "file:enterprise.db" }),
        options: {
          semanticRecall: { topK: 15, messageRange: 8 },
          workingMemory: { enabled: true },
        },
      });
    } else if (userTier === "pro") {
      return new Memory({
        storage: new LibSQLStore({ url: "file:pro.db" }),
        options: {
          semanticRecall: { topK: 8, messageRange: 4 },
          workingMemory: { enabled: true },
        },
      });
    }

    // Basic memory for free tier
    return new Memory({
      storage: new LibSQLStore({ url: "file:free.db" }),
      options: {
        semanticRecall: { topK: 3, messageRange: 2 },
        workingMemory: { enabled: false },
      },
    });
  },
});
```

この例では、エージェントは次のことを行います：

- ユーザーのサブスクリプションプラン（free、pro、enterprise）に応じて指示を調整する
- enterprise ユーザーには、より高性能なモデル（GPT-4）を使用する
- ユーザーのプランに応じて異なるツールセットを提供する
- ユーザーのプランに応じて能力の異なるメモリを構成する
- ユーザーが希望する言語で応答する

これにより、ランタイムコンテキストを活用することで、単一のエージェントがさまざまなタイプのユーザーやシナリオに対応でき、各ユースケースごとに個別のエージェントを作成するよりも柔軟で保守しやすいことが示されています。

API ルート、ミドルウェア設定、ランタイムコンテキストの取り扱いを含む完全な実装例については、[Dynamic Agents Example](/examples/agents/dynamic-agents) を参照してください。