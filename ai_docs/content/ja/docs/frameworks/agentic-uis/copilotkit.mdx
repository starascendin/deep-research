---
title: "CopilotKitã¨ã®ä½¿ç”¨"
description: "MastraãŒCopilotKitã®AGUIãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã©ã®ã‚ˆã†ã«æ´»ç”¨ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã®æ§‹ç¯‰ã«ã©ã®ã‚ˆã†ã«æ´»ç”¨ã§ãã‚‹ã‹ã‚’å­¦ã¶"
---

import { Tabs, Steps } from "nextra/components";
import Image from "next/image";



# CopilotKitã‚’Mastraã¨çµ±åˆã™ã‚‹

CopilotKitã¯ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªAIã‚³ãƒ‘ã‚¤ãƒ­ãƒƒãƒˆã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç´ æ—©ãçµ±åˆã™ã‚‹ãŸã‚ã®Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æä¾›ã—ã¾ã™ã€‚Mastraã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€åŒæ–¹å‘ã®çŠ¶æ…‹åŒæœŸã¨ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªUIã‚’ç‰¹å¾´ã¨ã™ã‚‹æ´—ç·´ã•ã‚ŒãŸAIã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚

CopilotKitã®æ¦‚å¿µã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€é«˜åº¦ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦è©³ã—ãå­¦ã¶ã«ã¯ã€[CopilotKitãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.copilotkit.ai/)ã‚’ã”è¦§ãã ã•ã„ã€‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€2ã¤ã®ç•°ãªã‚‹çµ±åˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ç´¹ä»‹ã—ã¾ã™ï¼š

1. åˆ¥ã®Reactãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚’æŒã¤Mastraã‚µãƒ¼ãƒãƒ¼ã«CopilotKitã‚’çµ±åˆã™ã‚‹
2. Next.jsã‚¢ãƒ—ãƒªã«CopilotKitã‚’çµ±åˆã™ã‚‹



<Tabs items={["Mastra Server", "Next.js" ]}>
  <Tabs.Tab>
    <Steps>
      ## Reactä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

      Reactãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã€å¿…è¦ãªCopilotKitãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

      <Tabs items={["npm", "yarn", "pnpm"]}>
        <Tabs.Tab>
          ```bash copy
          npm install @copilotkit/react-core @copilotkit/react-ui
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          yarn add @copilotkit/react-core @copilotkit/react-ui
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          pnpm add @copilotkit/react-core @copilotkit/react-ui
          ```
        </Tabs.Tab>
      </Tabs>

      ## CopilotKitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ

      Reactãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

      ```tsx filename="components/copilotkit-component.tsx" showLineNumbers copy
      import { CopilotChat } from "@copilotkit/react-ui";
      import { CopilotKit } from "@copilotkit/react-core";
      import "@copilotkit/react-ui/styles.css";

      export function CopilotKitComponent({ runtimeUrl }: { runtimeUrl: string}) {
        return (
          <CopilotKit
            runtimeUrl={runtimeUrl}
            agent="weatherAgent"
          >
            <CopilotChat
              labels={{
                title: "Your Assistant",
                initial: "Hi! ğŸ‘‹ How can I assist you today?",
              }}
            />
          </CopilotKit>
        );
      }
      ```

      ## ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

      ã¾ã Mastraã‚µãƒ¼ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ã„ãªã„å ´åˆã¯ã€[ã¯ã˜ã‚ã«](/docs/getting-started/installation)ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦æ–°ã—ã„Mastraãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚

      Mastraã‚µãƒ¼ãƒãƒ¼ã§CopilotKitçµ±åˆç”¨ã®è¿½åŠ ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

      <Tabs items={["npm", "yarn", "pnpm"]}>
        <Tabs.Tab>
          ```bash copy
          npm install @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          yarn add @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          pnpm add @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>
      </Tabs>

      ## Mastraã‚µãƒ¼ãƒãƒ¼ã‚’è¨­å®š

      CopilotKitã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å«ã‚€ã‚ˆã†ã«Mastraã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¨­å®šã—ã¾ã™ï¼š

      ```typescript filename="src/mastra/index.ts" showLineNumbers copy {5-8,12-28}
      import { Mastra } from "@mastra/core/mastra";
      import { registerCopilotKit } from "@ag-ui/mastra";
      import { weatherAgent } from "./agents/weather-agent";

      type WeatherRuntimeContext = {
        "user-id": string;
        "temperature-scale": "celsius" | "fahrenheit";
      };

      export const mastra = new Mastra({
        agents: { weatherAgent },
        server: {
          cors: {
            origin: "*",
            allowMethods: ["*"],
            allowHeaders: ["*"]
          },
          apiRoutes: [
            registerCopilotKit<WeatherRuntimeContext>({
              path: "/copilotkit",
              resourceId: "weatherAgent",
              setContext: (c, runtimeContext) => {
                runtimeContext.set("user-id", c.req.header("X-User-ID") || "anonymous");
                runtimeContext.set("temperature-scale", "celsius");
              }
            })
          ]
        }
      });
      ```

      ## Reactã‚¢ãƒ—ãƒªã§ã®Usage

      Mastraã‚µãƒ¼ãƒãƒ¼ã®URLã‚’ä½¿ç”¨ã—ã¦Reactã‚¢ãƒ—ãƒªã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

      ```tsx filename="App.tsx" showLineNumbers copy {5}
      import { CopilotKitComponent } from "./components/copilotkit-component";

      function App() {
        return (
          <CopilotKitComponent runtimeUrl="http://localhost:4111/copilotkit" />
        );
      }

      export default App;
      ```
    </Steps>
  </Tabs.Tab>

  <Tabs.Tab>
    <Steps>
      ## ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

      Next.jsã‚¢ãƒ—ãƒªã§ã€å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼š

      <Tabs items={["npm", "yarn", "pnpm"]}>
        <Tabs.Tab>
          ```bash copy
          npm install @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          yarn add @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ```bash copy
          pnpm add @copilotkit/react-core @copilotkit/react-ui @copilotkit/runtime @ag-ui/mastra
          ```
        </Tabs.Tab>
      </Tabs>

      ## CopilotKitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ \[#full-stack-nextjs-create-copilotkit-component]

      CopilotKitã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

      ```tsx filename="components/copilotkit-component.tsx" showLineNumbers copy
      'use client';
      import { CopilotChat } from "@copilotkit/react-ui";
      import { CopilotKit } from "@copilotkit/react-core";
      import "@copilotkit/react-ui/styles.css";

      export function CopilotKitComponent({ runtimeUrl }: { runtimeUrl: string}) {
        return (                                                       y
          <CopilotKit
            runtimeUrl={runtimeUrl}
            agent="weatherAgent"
          >
            <CopilotChat
              labels={{
                title: "Your Assistant",
                initial: "Hi! ğŸ‘‹ How can I assist you today?",
              }}
            />
          </CopilotKit>
        );
      }
      ```

      ## API ãƒ«ãƒ¼ãƒˆã®ä½œæˆ

      Next.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§Mastraã‚’çµ±åˆã™ã‚‹æ–¹æ³•ã«ã‚ˆã£ã¦æ±ºã¾ã‚‹ã€API ãƒ«ãƒ¼ãƒˆã®2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒã‚ã‚Šã¾ã™ã€‚

      1. ã‚¢ãƒ—ãƒªã«Mastraã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒçµ±åˆã•ã‚ŒãŸãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯Next.jsã‚¢ãƒ—ãƒªã®å ´åˆ
      2. åˆ¥ã®Mastraã‚µãƒ¼ãƒãƒ¼ã¨Mastra Client SDKã‚’ä½¿ç”¨ã™ã‚‹Next.jsã‚¢ãƒ—ãƒªã®å ´åˆ

      <Tabs items={["Mastraã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨", "Mastra Client SDKã‚’ä½¿ç”¨"]}>
        <Tabs.Tab>
          ãƒ­ãƒ¼ã‚«ãƒ«ã®Mastraã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹APIãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

          ```typescript filename="app/api/copilotkit/route.ts" showLineNumbers copy {1-7,11-26}
          import { mastra } from "../../mastra";
          import {
            CopilotRuntime,
            ExperimentalEmptyAdapter,
            copilotRuntimeNextJSAppRouterEndpoint,
          } from "@copilotkit/runtime";
          import { MastraAgent } from "@ag-ui/mastra";
          import { NextRequest } from "next/server";

          export const POST = async (req: NextRequest) => {
            const mastraAgents = MastraAgent.getLocalAgents({
              mastra,
              agentId: "weatherAgent",
            });

            const runtime = new CopilotRuntime({
              agents: mastraAgents,
            });

            const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
              runtime,
              serviceAdapter: new ExperimentalEmptyAdapter(),
              endpoint: "/api/copilotkit",
            });

            return handleRequest(req);
          };
          ```
        </Tabs.Tab>

        <Tabs.Tab>
          ## Mastra Client SDKã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

          Mastra Client SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

          <Tabs items={["npm", "yarn", "pnpm"]}>
            <Tabs.Tab>
              ```bash copy
              npm install @mastra/client-js
              ```
            </Tabs.Tab>

            <Tabs.Tab>
              ```bash copy
              yarn add @mastra/client-js
              ```
            </Tabs.Tab>

            <Tabs.Tab>
              ```bash copy
               pnpm add @mastra/client-js
              ```
            </Tabs.Tab>
          </Tabs>

          ãƒªãƒ¢ãƒ¼ãƒˆã®Mastraã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«æ¥ç¶šã™ã‚‹APIãƒ«ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

          ```typescript filename="app/api/copilotkit/route.ts" showLineNumbers copy {1-7,12-26}
          import { MastraClient } from "@mastra/client-js";
          import {
            CopilotRuntime,
            ExperimentalEmptyAdapter,
            copilotRuntimeNextJSAppRouterEndpoint,
          } from "@copilotkit/runtime";
          import { MastraAgent } from "@ag-ui/mastra";
          import { NextRequest } from "next/server";

          export const POST = async (req: NextRequest) => {
            const baseUrl = process.env.MASTRA_BASE_URL || "http://localhost:4111";
            const mastraClient = new MastraClient({ baseUrl });

            const mastraAgents = await MastraAgent.getRemoteAgents({ mastraClient });

            const runtime = new CopilotRuntime({
              agents: mastraAgents,
            });

            const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
              runtime,
              serviceAdapter: new ExperimentalEmptyAdapter(),
              endpoint: "/api/copilotkit",
            });

            return handleRequest(req);
          };
          ```
        </Tabs.Tab>
      </Tabs>

      ## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹

      ãƒ­ãƒ¼ã‚«ãƒ«APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ï¼š

      ```tsx filename="App.tsx" showLineNumbers copy {5}
      import { CopilotKitComponent } from "./components/copilotkit-component";

      function App() {
        return (
          <CopilotKitComponent runtimeUrl="/api/copilotkit" />
        );
      }

      export default App;
      ```
    </Steps>
  </Tabs.Tab>
</Tabs>




æœªæ¥ã®æ§‹ç¯‰ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼

<br />

<Image
  className="rounded-lg"
  src="/image/copilotkit/cpkoutput.jpg"
  alt="CopilotKit output"
  width={700}
  height={700}
/>



## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- [CopilotKit Documentation](https://docs.copilotkit.ai) - å®Œå…¨ãªCopilotKitãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- [React Hooks with CopilotKit](https://docs.copilotkit.ai/reference/hooks/useCoAgent) - é«˜åº¦ãªReactçµ±åˆãƒ‘ã‚¿ãƒ¼ãƒ³
- [Next.js Integration with Mastra](/docs/frameworks/web-frameworks/next-js) - ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯Next.jsã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
